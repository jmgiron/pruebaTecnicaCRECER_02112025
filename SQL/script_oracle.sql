-- Script Oracle para tablas de incidencias

CREATE TABLE CATEGORIA (
    ID          NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    NOMBRE      VARCHAR2(100) NOT NULL,
    CONSTRAINT PK_CATEGORIA PRIMARY KEY (ID)
);

CREATE TABLE INCIDENCIA (
    ID              NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    TITULO          VARCHAR2(200) NOT NULL,
    DESCRIPCION     CLOB NOT NULL,
    CATEGORIA_ID    NUMBER NOT NULL,
    SEVERIDAD       VARCHAR2(50) NOT NULL,
    ESTADO          VARCHAR2(50) NOT NULL,
    FECHA_REGISTRO  DATE DEFAULT SYSDATE,
    CONSTRAINT PK_INCIDENCIA PRIMARY KEY (ID),
    CONSTRAINT FK_INCIDENCIA_CATEGORIA FOREIGN KEY (CATEGORIA_ID)
        REFERENCES CATEGORIA(ID)
);

CREATE TABLE BITACORA_INCIDENCIA (
    ID              NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    INCIDENCIA_ID   NUMBER NOT NULL,
    USUARIO         VARCHAR2(100) NOT NULL,
    FECHA_HORA      DATE DEFAULT SYSDATE,
    ESTADO_ANTERIOR VARCHAR2(50),
    ESTADO_NUEVO    VARCHAR2(50),
    COMENTARIO      CLOB,
    ACCION          VARCHAR2(200),
    CONSTRAINT PK_BITACORA_INCIDENCIA PRIMARY KEY (ID),
    CONSTRAINT FK_BITACORA_INCIDENCIA FOREIGN KEY (INCIDENCIA_ID)
        REFERENCES INCIDENCIA(ID)
);

-- Opcional: índice para búsquedas rápidas por estado
CREATE INDEX IDX_INCIDENCIA_ESTADO ON INCIDENCIA(ESTADO);
